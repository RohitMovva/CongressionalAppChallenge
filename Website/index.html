<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Scroll Effects V2</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="style.css">
        <script src="script.js" defer></script>
    </head>
    <body>
        
        <main>

            <div class="snap">
                <header>
                    <h1>Course Rescheduler</h1>
                </header>
            </div>

            <div class="snap">
                <section class="my-class">
                    <section class="stagger test">
                        <h2>What it is</h2>
                        <p>This is a course rescheduler that you can use to move your courses around. Made by Rohit, Pierce, Alden, and Joshua.</p>
                        <img src="placeholder_parrot1.jfif" alt="green parrot hanging off a tree">
                    </section>
        
                    <section class="stagger">
                        <h2>What it does</h2>
                        <p>After a masterlist of classes in inputed, the class to be removed, and the class to be added are inputed it returns your new scheduel that will have all the classe you need.</p>
                        <img src="placeholder_parrot2.jfif" alt="red parrot">
                    </section>
        
                    <section class="stagger2">
                        <h2>What it supports</h2>
                        <p>idk im writing this too late for my brain to work right</p>
                        <ul>
                            <li>we probs want a list for thi</li>
                            <li>hi  hello</li>
                            <li>greetings salutations</li>
                            <li>placeholder parrot best parrot</li>
                        </ul>
                    </section>
                </section>
            </div>

            <div class="snap">
                <div class="centered">
                    <h1>Call API</h1>
                    <form id="myForm">
                        <input type="file" id="csvFile" accept=".csv" />
                        <br />
                        <input type="submit" value="Submit" />
                        <!-- <input type="text" id="username" placeholder="Enter your name"> -->
                        <!-- <button onclick="callAPI()">Greet Me</button> -->
                        <p id="response"></p>
                </div>
                <script>
                    const myForm = document.getElementById("myForm");
                    const csvFile = document.getElementById("csvFile");
                    var classes = [];
                    myForm.addEventListener("submit", function (e) {
                        let datar = "";
                        e.preventDefault();
                        const input = csvFile.files[0];
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            const text = e.target.result;
                            datar = text;
                            fetch(`http://127.0.0.1:5000/api/greet`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    "username": datar
                                })
                            })
                            .then(response => response.json())
                            .then(data => {
                                document.getElementById("response").innerText = data.message;
                                classes = data.class_list;
                                // UPDATE THE FORM HERE
                                let list = document.getElementById("myList");
                                for (i = 0; i < classes.length; i++) {
                                    let li = document.createElement('li');
                                    li.innerText = classes[i];
                                    console.log(li);
                                    list.appendChild(li);
                                }
                                console.log(classes);
                            })
                            .catch(error => {
                                console.error("Error fetching data: ", error);
                                document.getElementById("response").innerText = "Error fetching data!";
                            });
                        };
                        console.log(datar);
                        console.log(classes);
                        reader.readAsText(input);  
                    });
                </script>
                <section class="form">
                    <p>this is where the form will go woo ima get to that tommorow</p>
                    <ul, id="myList"></ul>
                </section>
            </div>
            
        </main>

    </body>
</html>